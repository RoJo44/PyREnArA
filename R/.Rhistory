par(mar = c(5,4,4,1)) # Grenzen ?ndern
barplot(100*inrexp[ranks,1], names.arg=rownames(inrexp)[ranks], las=2,
cex.names=.7, space=0, width=1, ylim=c(0,yv))
title(main="Kanonisch erkl?rte Varianz des jeweiligen Merkmals",
ylab="Prozent erkl?rter Streuung bei Merkmal")
(lim <- round(max( abs(c(covar,mmalkoo[,1:2], fallkoo[,1:2])))+0.1,0))
(lim <- c(-1*lim,lim))
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=seq(lim[1], lim[2], .1 ) ,h=seq(lim[1], lim[2],.1 ), lty=3, col=gray(.9))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, rownames(covar), cex=.8, font=4)
(lim <- round(max(abs(c(covar,mmalkoo[,1:2], fallkoo[,1:2])))))
(lim <- c(-1*lim,lim))
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=seq(lim[1], lim[2], .1 ) ,h=seq(lim[1], lim[2],.1 ), lty=3, col=gray(.9))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, rownames(covar), cex=.8, font=4)
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file="../../png/R/02_RDA_Triplot.png", width=8333, height=5156, res=1200)
png(file="../../RDA_Triplot.png", width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
png(file="C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/RDA_Triplot.png", width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz   <- round(100*eigvalperc[1:2],1)
dev.off()
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
str(datfram)
Y <- datfram[,2:13]
str(Y)
head(Y)
x <- datfram[,'ka_cal_BP']
res <- vegan::rda(Y~x, scale=TRUE)
vegan::anova.cca(res, alpha=0.05, beta=0.01, step=1000, perm.max=9999)
(Anteilerklaert <- vegan::RsquareAdj(res)[[2]])
summary(res)$cont # Anteile der Streuung pro Achse
summary(res)$cont$importance[2,1]
Anteilerklaert
(eigvalperc <- summary(res)$cont$importance[2,])
(ymax <- round(100*max(eigvalperc)+5,0))
barplot(100*eigvalperc, las=2, names.arg=names(eigvalperc), cex.names=.7,
space=0, width=1, ylim=c(0,ymax ),
main="Eigenwertdiagramm",
ylab="Prozent erkl?rter Streuung pro Achse")
plot(res, scaling=1, display=c("sp","wa","bp"), las=1)
text(res, scaling=1, display="sp", las=1)
text(res, scaling=1, display="bp", las=1)
k <- length(eigvalperc)	# Achsenanzahl
# Fall-Koordinaten  (Positionen der Fallpunkte)
fallkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$sites
mmalkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$species
kk <- length(res$CCA$eig)	# Anzahl kanonischer Achsen, hier 1
(covar <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = "sites", 1)$biplot)
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file="C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/RDA_Triplot.png", width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz   <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main="Triplot of RDA (canonical )", cex.axis=.8,
xlab="RDA I", ylab="PCA I", sub=subtextri, cex.sub=.8)
dev.off()
(inrexp <- inertcomp(object = res, display = "species", proportional = TRUE))
yv <- round(100*max(inrexp)+5, -1)
ranks <- order(inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
oldpar <- par() # Grundeinstellungen hinterlegen
par(mar = c(5,4,4,1)) # Grenzen ?ndern
barplot(100*inrexp[ranks,1], names.arg=rownames(inrexp)[ranks], las=2,
cex.names=.7, space=0, width=1, ylim=c(0,yv))
title(main="Kanonisch erkl?rte Varianz des jeweiligen Merkmals",
ylab="Prozent erkl?rter Streuung bei Merkmal")
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file="../../png/R/03_RDA_cases_coloured.png", width=8333, height=5156, res=1200)
plot(0,0, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
png(file="C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/RDA_Triplot_colored.png", width=8333, height=5156, res=1200)
plot(0,0, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
(tk <- nlevels(as.factor(x))) # 13 Zeitstufen
xfac <- as.factor(x) # Zeitstufen als Nominalmerkmal
points(fallkoo[,1:2], pch=21, bg=rainbow(13)[xfac], col=rbcol, cex=0.7)	# row points
legend("right", pch=rep(21,13), pt.bg=rainbow(13), unique(invennam ))
title(main="RDA: Streudiagramm der F?lle", cex.axis=.8,
xlab="RDA I", ylab="PCA I")
dev.off()
rda(directory, data_file)
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
rda(directory, data_file)
rda(directory, data_file)
print(x)
View(datfram)
View(Y)
str(x)
head(x)
print(x)
rda(directory, data_file)
x <- datfram[,14]
rda(directory, data_file)
rda(directory, data_file)
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
rda(directory, data_file)
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
str(datfram)
require(vegan)
require(vegan)
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
require(vegan)
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
View(datfram)
str(datfram)
Y <- datfram[,2:13]
str(Y)
head(Y)
x <- datfram[,'ka_cal_BP']
res <- vegan::rda(Y~x, scale=TRUE)
vegan::anova.cca(res, alpha=0.05, beta=0.01, step=1000, perm.max=9999)
(Anteilerklaert <- vegan::RsquareAdj(res)[[2]])
summary(res)$cont # Anteile der Streuung pro Achse
summary(res)$cont$importance[2,1]
Anteilerklaert
(eigvalperc <- summary(res)$cont$importance[2,])
(ymax <- round(100*max(eigvalperc)+5,0))
barplot(100*eigvalperc, las=2, names.arg=names(eigvalperc), cex.names=.7,
space=0, width=1, ylim=c(0,ymax ),
main="Eigenwertdiagramm",
ylab="Prozent erkl?rter Streuung pro Achse")
barplot(100*eigvalperc, las=2, names.arg=names(eigvalperc), cex.names=.7,
space=0, width=1, ylim=c(0,ymax ),
main="Eigenwertdiagramm",
ylab="Prozent erkl?rter Streuung pro Achse")
plot(res, scaling=1, display=c("sp","wa","bp"), las=1)
text(res, scaling=1, display="sp", las=1)
text(res, scaling=1, display="bp", las=1)
k <- length(eigvalperc)	# Achsenanzahl
# Fall-Koordinaten  (Positionen der Fallpunkte)
fallkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$sites
mmalkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$species
kk <- length(res$CCA$eig)	# Anzahl kanonischer Achsen, hier 1
(covar <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = "sites", 1)$biplot)
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file = directory + "RDA_Triplot.png", width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz   <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main = "Triplot of RDA (canonical variable is cause)", cex.axis=.8,
xlab = "RDA I", yla b= "PCA I", sub=subtextri, cex.sub=.8)
dev.off()
(inrexp <- inertcomp(object = res, display = "species", proportional = TRUE))
yv <- round(100*max(inrexp)+5, -1)
ranks <- order(inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
oldpar <- par() # Grundeinstellungen hinterlegen
par(mar = c(5,4,4,1)) # Grenzen ?ndern
barplot(100*inrexp[ranks,1], names.arg=rownames(inrexp)[ranks], las=2,
cex.names=.7, space=0, width=1, ylim=c(0,yv))
title(main="Kanonisch erkl?rte Varianz des jeweiligen Merkmals",
ylab="Prozent erkl?rter Streuung bei Merkmal")
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file = directory + "RDA_Triplot.png", width=8333, height=5156, res=1200)
png(file = c(directory,"RDA_Triplot.png"), width=8333, height=5156, res=1200)
png(file = paste(directory,"RDA_Triplot.png",sep=''), width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz   <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main = "Triplot of RDA (canonical variable is cause)", cex.axis=.8,
xlab = "RDA I", yla b= "PCA I", sub=subtextri, cex.sub=.8)
dev.off()
title(main = "Triplot of RDA (canonical variable is cause)", cex.axis=.8,
xlab = "RDA I", yla b= "PCA I", sub=subtextri, cex.sub=.8)
png(file = paste(directory,"RDA_Triplot.png",sep=''), width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz   <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main = "Triplot of RDA (canonical variable is cause)", cex.axis=.8,
xlab = "RDA I", yla b= "PCA I", sub=subtextri, cex.sub=.8)
title(main="Triplot of RDA (canonical variable is cause)", cex.axis=.8,
xlab="RDA I", yla b= "PCA I", sub=subtextri, cex.sub=.8)
title(main="Triplot of RDA (canonic variable is cause)", cex.axis=.8,
xlab="RDA I", ylab="PCA I", sub=subtextri, cex.sub=.8)
dev.off()
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
rda(directory, data_file)
require(vegan)
datfram <- read.csv(data_file, header=TRUE, sep=",", dec=".", row.names = 1)
str(datfram)
Y <- datfram[,2:13]
str(Y)
head(Y)
x <- datfram[,'ka_cal_BP']
res <- vegan::rda(Y~x, scale=TRUE)
vegan::anova.cca(res, alpha=0.05, beta=0.01, step=1000, perm.max=9999)
(Anteilerklaert <- vegan::RsquareAdj(res)[[2]])
summary(res)$cont # Anteile der Streuung pro Achse
summary(res)$cont$importance[2,1]
Anteilerklaert
(eigvalperc <- summary(res)$cont$importance[2,])
(ymax <- round(100*max(eigvalperc)+5,0))
barplot(100*eigvalperc, las=2, names.arg=names(eigvalperc), cex.names=.7,
space=0, width=1, ylim=c(0,ymax ),
main="Eigenwertdiagramm",
ylab="Prozent erkl?rter Streuung pro Achse")
plot(res, scaling=1, display=c("sp","wa","bp"), las=1)
text(res, scaling=1, display="sp", las=1)
text(res, scaling=1, display="bp", las=1)
k <- length(eigvalperc)	# Achsenanzahl
# Fall-Koordinaten  (Positionen der Fallpunkte)
fallkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$sites
mmalkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$species
kk <- length(res$CCA$eig)	# Anzahl kanonischer Achsen, hier 1
(covar <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = "sites", 1)$biplot)
(lim <- 0.5)
(lim <- c(-1*lim,lim))
png(file = paste(directory,"RDA_Triplot.png",sep=''), width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
proz <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main="Triplot of RDA (canonic variable is cause)", cex.axis=.8,
xlab="RDA I", ylab="PCA I", sub=subtextri, cex.sub=.8)
dev.off()
(inrexp <- inertcomp(object = res, display = "species", proportional = TRUE))
yv <- round(100*max(inrexp)+5, -1)
ranks <- order(inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
oldpar <- par() # Grundeinstellungen hinterlegen
par(mar = c(5,4,4,1)) # Grenzen ?ndern
barplot(100*inrexp[ranks,1], names.arg=rownames(inrexp)[ranks], las=2,
cex.names=.7, space=0, width=1, ylim=c(0,yv))
title(main="Kanonisch erkl?rte Varianz des jeweiligen Merkmals",
ylab="Prozent erkl?rter Streuung bei Merkmal")
# Export rda data
sc_si <- scores(res, display="sites", choices=c(1,2), scaling=1)
datfram$RDA <- sc_si[,1:2]
write.csv(datfram,paste(directory,'_rda.csv'), col.names = T, sep=",",fileEncoding ="UTF-8")
write.csv(datfram,paste(directory,'data_metrics_rda.csv'), fileEncoding ="UTF-8")
(negpos <- ifelse(mmalkoo[,1]<0, -1,1))
ranks2 <- order(negpos*inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
png(file=paste(directory,"RDA_scattering_per_trait_orientated.png"), width=8333, height=5156, res=1200)
barplot((negpos*100*inrexp[,1])[ranks2], names.arg=rownames(inrexp)[ranks2], las=2,
cex.names=.7, space=0, width=1, ylim=c(-yvlim,yvlim))
yvlim <- 10
(negpos <- ifelse(mmalkoo[,1]<0, -1,1))
ranks2 <- order(negpos*inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
png(file=paste(directory,"RDA_scattering_per_trait_orientated.png"), width=8333, height=5156, res=1200)
barplot((negpos*100*inrexp[,1])[ranks2], names.arg=rownames(inrexp)[ranks2], las=2,
cex.names=.7, space=0, width=1, ylim=c(-yvlim,yvlim))
title(main="Kanonisch erkl?rte Varianz des jeweiligen Merkmals",
ylab="Abnahme  -- Prozent erkl?rter Streuung -- Zunahme")
dev.off()
title(main="Canonic Variable explaines variance of traits",
ylab="% explained variance")
(negpos <- ifelse(mmalkoo[,1]<0, -1,1))
ranks2 <- order(negpos*inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
png(file=paste(directory,"RDA_scattering_per_trait_orientated.png"), width=8333, height=5156, res=1200)
barplot((negpos*100*inrexp[,1])[ranks2], names.arg=rownames(inrexp)[ranks2], las=2,
cex.names=.7, space=0, width=1, ylim=c(-yvlim,yvlim))
title(main="Canonic Variable explaines variance of traits",
ylab="% explained variance")
dev.off()
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
rda(directory, data_file)
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
rda(directory, data_file)
directory = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/"
data_file = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
rda(directory, data_file)
rda(directory, data_file)
rda(directory, data_file, 'ka_cal_BP')
datfram <- read.csv(directory_to_data, header=TRUE, sep=",", dec=".", row.names = 1)
directory_to_data = "C:/Users/RobinJohn/Documents/Beyond_Typology/beyond_typology/data_metrics_merged_metadata_filtered.csv"
require(vegan)
datfram <- read.csv(directory_to_data, header=TRUE, sep=",", dec=".", row.names = 1)
str(datfram)
Y <- datfram[,2:13]
str(Y)
head(Y)
x <- datfram[,parameter]
x <- datfram[,'ka_cal_BP']
traceback(rda(directory, data_file, 'ka_cal_BP'))
traceback()
rda(directory, data_file, 'ka_cal_BP')
traceback()
rda(directory, data_file, 'ka_cal_BP')
rda_function(directory, data_file, 'ka_cal_BP')
rda_function <- function(dire, directory_to_data, parameter) {
require(vegan)
datfram <- read.csv(directory_to_data, header=TRUE, sep=",", dec=".", row.names = 1)
str(datfram)
Y <- datfram[,2:13]
str(Y)
head(Y)
x <- datfram[,parameter]
res <- vegan::rda(Y~x, scale=TRUE)
vegan::anova.cca(res, alpha=0.05, beta=0.01, step=1000, perm.max=9999)
(Anteilerklaert <- vegan::RsquareAdj(res)[[2]])
summary(res)$cont # Anteile der Streuung pro Achse
summary(res)$cont$importance[2,1]
Anteilerklaert
##    2.3. Darstellung
# 2.3.1. Eigenwertdiagramm (screeplot)
# Eigenwertdiagramm kommt IMMER zuerst (auch bei CA, PCA etc.)
(eigvalperc <- summary(res)$cont$importance[2,])
# Vektor der Streuungsanteile pro Achse
(ymax <- round(100*max(eigvalperc)+5,0))
# Wie hoch soll das S?ulendiagramm werden ?
barplot(100*eigvalperc, las=2, names.arg=names(eigvalperc), cex.names=.7,
space=0, width=1, ylim=c(0,ymax ),
main="Eigenwertdiagramm",
ylab="Prozent erkl?rter Streuung pro Achse")
# 2.3.2. Triplot quick and dirty
# Triplot-Deutung
# - F?lle nah bei einander sind ?hnlich;
#   F?lle in Richtung einer Merkmalspfeilspitze haben
#   bei diesem Merkmal ?berdurchschnittlich hohe Werte;
#   F?lle beim Achsenursprung haben durchschnittliche Werte
#   F?lle auf MMpfeil entgegenges. Seite haben unter-
#   durchschnittliche Werte.
# - Merkmalspfeile, die in ungef?hr gleiche Richtung
#   zeigen, nehmen ?berwiegend gemeinsam zu und ab;
#   Merkmalspfeile, die in ungef?hr gleiche Richtung
#   zeigen wie Ursachenvariable, nehmen mit dieser
#   gemeinsam zu und ab.
#   Merkmalspfeile, die in ungef?hr rechtinklig zur
#   Ursachenvariable liegen, haben zu dieser keine
#   Beziehung.
# QUICK and DIRTY
plot(res, scaling=1, display=c("sp","wa","bp"), las=1)
text(res, scaling=1, display="sp", las=1)
text(res, scaling=1, display="bp", las=1)
#
# 2.3.3. Triplot mit umfangreichen Details
#	Koordinaten
k <- length(eigvalperc)	# Achsenanzahl
# Fall-Koordinaten  (Positionen der Fallpunkte)
fallkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$sites
# Merkmals-Koordinaten (Positionen der Merkmals-Pfeilspitzen)
mmalkoo <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = 1, 1)$species
# Ursachen-Koordinaten (Positionen der Pfeilspitzen)
kk <- length(res$CCA$eig)	# Anzahl kanonischer Achsen, hier 1
(covar <- scores(res, choices = c(1:k), display = c("sp","wa","bp"),
scaling = "sites", 1)$biplot)
#	Richtig anspruchsvoller Triplot
# Diagrammgrenze
(lim <- 0.5)
(lim <- c(-1*lim,lim))
# Leeres Diagramm
png(file = paste(dire,"RDA_Triplot.png",sep=''), width=8333, height=5156, res=1200)
plot(mmalkoo, type="n", asp=1, xlim=lim, ylim=lim, las=1, xlab="", ylab="")
# ein Gitter
abline(v=0, lty=3, col=gray(.7))
abline(h=0, lty=3, col=gray(.7))
# F?lle
rcol <- rgb(.8,.8,.8,.3)	# ein transparentes helles Grau
rbcol<- gray(.2)				# ein dunkles Grau
points(fallkoo[,1:2], pch=21, bg=rcol, col=rbcol, cex=0.6)	# row points
# Merkmale
cbcol<- gray(.2)				#
arrows(0,0,mmalkoo[,1],mmalkoo[,2], lwd=1, length=.05, angle=15, col=cbcol)
tcol <- rgb(.2,.2,.2,.6)	# Textfarbe
text(mmalkoo, rownames(mmalkoo), pos=3, cex=.8, font=3, col=tcol)	# annotation for cols
# Ursachenvariable
arrows(0,0,covar[,1],covar[,2], lwd=3, length=.1, angle=15, col=cbcol)
text( covar[,1]*1.05, covar[,2]*1.05, "ka cal BP", pos=4, cex=1.2, font=4)
# Subtext
proz <- round(100*eigvalperc[1:2],1)
subtextri <- paste("Triplot shows", sum(proz), "% of the variance")
title(main="Triplot of RDA (canonic variable is cause)", cex.axis=.8,
xlab="RDA I", ylab="PCA I", sub=subtextri, cex.sub=.8)
dev.off()
# 2.3.4. Jeweils pro Merkmal von Ursache erkl?rte Streuung
(inrexp <- inertcomp(object = res, display = "species", proportional = TRUE))
yvlim <- 10
yv <- round(100*max(inrexp)+5, -1)
ranks <- order(inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
# Zul?ssige Druckgrenzen ?ndern
oldpar <- par() # Grundeinstellungen hinterlegen
par(mar = c(5,4,4,1)) # Grenzen ?ndern
# Diagramm
barplot(100*inrexp[ranks,1], names.arg=rownames(inrexp)[ranks], las=2,
cex.names=.7, space=0, width=1, ylim=c(0,yv))
title(main="Canonic variable explaines variance of traits",
ylab="% explained variance")
# Diagramm erweitert
# Jetzt wird mit nega- oder positivem Wert angezeigt,
# ob Merkmalswerte mit Alter ab- oder zunehmen.
(negpos <- ifelse(mmalkoo[,1]<0, -1,1))
# logische Frage, ob Zahlen negativ; bei ja '-1', bei nein '+1'
ranks2 <- order(negpos*inrexp[,1]) # Vektor der Gr??en-Reihenfolge der Anteile
png(file=paste(dire,"RDA_scattering_per_trait_orientated.png"), width=8333, height=5156, res=1200)
barplot((negpos*100*inrexp[,1])[ranks2], names.arg=rownames(inrexp)[ranks2], las=2,
cex.names=.7, space=0, width=1, ylim=c(-yvlim,yvlim))
title(main="Canonic variable explaines variance of traits",
ylab="% explained variance")
dev.off()
# Export rda data
sc_si <- scores(res, display="sites", choices=c(1,2), scaling=1)
datfram$RDA <- sc_si[,1:2]
write.csv(datfram,paste(dire,'data_metrics_rda.csv'), fileEncoding ="UTF-8")
}
rda_function(directory, data_file, 'ka_cal_BP')
